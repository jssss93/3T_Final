<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="qa">
     
    <select id="QA_selectList" parameterType="hashmap" resultType="hashmap">
   <!--  select 
 				A.QA_NO,
      			A.TITLE,
      		    A.MEMBER_ID,
        		A.CONTENT,
        		A.REGDATE,
        		A.CATEGORY,
				A.REF,
				A.RE_STEP,
				A.RE_LEVEL,
				A.GOODS_NO,
       			B.SAV_NAME
		  from
                QA A
          INNER JOIN 
                UPLOAD B 
          ON 
               A.GOODS_NO = B.GOODS_NO 
         ORDER BY 
               
               A.ref DESC, A.re_step ASC  
           		 -->
        <![CDATA[
           		SELECT
           		QA_NO,
           		TITLE,
           		MEMBER_ID,
           		CONTENT,
           		REGDATE,
           		CATEGORY,
				REF,
				RE_STEP,
				RE_LEVEL,
				GOODS_NO,
				STATUS
           		
           	FROM 
           		QA
           		ORDER BY ref DESC, re_step ASC
        ]]>
    </select>
    
    <insert id="QA_insert" parameterType="hashmap">
      <![CDATA[
      
         INSERT INTO
		QA (
			QA_NO,
			TITLE,
			PASSWD,
			CONTENT,
			REGDATE,
			CATEGORY,
			STATUS,

			REF,
		
			
			MEMBER_ID,
			GOODS_NO

		)
		VALUES (
			QA_NO_SEQ.NEXTVAL,
			#{TITLE},
			#{PASSWD},
			#{CONTENT},
			SYSDATE,
			#{CATEGORY},
			#{STATUS},
		
			QA_NO_SEQ.CURRVAL,
			
			
			#{MEMBER_ID},
			#{GOODS_NO}
		 	
		)
    ]]>
  <!--#{CATEGORY}   
  #{REF},
			#{REF_STEP},
			#{RE_LEVEL},
		
			#{GOODS_NO}  -->
</insert>
    <select id="QA_selectDetail" parameterType="hashmap" resultType="hashmap">
      <![CDATA[
        SELECT
            QA_NO,
            TITLE,
            MEMBER_ID,
            REGDATE,
            CONTENT,
			CATEGORY,
			GOODS_NO
        FROM
            QA
        WHERE
            QA_NO = #{QA_NO}       
      ]]>
    </select>
    <update id="QA_update" parameterType="hashmap">
    <![CDATA[
        UPDATE 
			QA
        SET
            TITLE = #{TITLE},
            CONTENT = #{CONTENT}
			
        WHERE
            QA_NO = #{QA_NO}
    ]]>
</update>
    
    <update id="QA_delete" parameterType="hashmap">
		<![CDATA[
			DELETE
			 	
			FROM
				QA
			WHERE
				QA_NO = #{QA_NO}
		]]>
	</update>
    
     <select id="QA_selectSearchList" parameterType="hashmap" resultType="hashmap">
		
			SELECT
           		QA_NO,
           		TITLE,
           		MEMBER_ID,
           		CONTENT,
           		REGDATE,
           		CATEGORY,
				REF,
				RE_STEP,
				RE_LEVEL,
				GOODS_NO,
				STATUS
		FROM 
			QA
		WHERE 
			
			
			<if test='SearchNum.equals("TITLE")'> 
			
			(TITLE LIKE '%' || #{SearchKeyword} || '%')
			
			</if>
			
			 <if test='SearchNum.equals("MEMBER_ID")'> 
			  
			(MEMBER_ID LIKE '%' || #{SearchKeyword} || '%')
			
			</if> 
			
			<if test='SearchNum.equals("CONTENT")'>
		
			(CONTENT LIKE '%' || #{SearchKeyword} || '%')
			</if>
			
			ORDER BY QA_NO DESC

		
</select>

   <insert id="QaInsertReply" parameterType="hashmap">
      <![CDATA[
			  INSERT INTO
		QA (
			QA_NO,
			TITLE,
			MEMBER_ID,
			PASSWD,
			CONTENT,
			REGDATE,
			CATEGORY,
			
			REF,
			RE_STEP,
			
			GOODS_NO,
			STATUS
			
		)
		VALUES (
			QA_NO_SEQ.NEXTVAL,
			#{TITLE},
			#{MEMBER_ID},
			#{PASSWD},
			#{CONTENT},
			SYSDATE,
			#{CATEGORY},
			
			#{REF},
			#{RE_STEP},
		
			#{GOODS_NO},
			#{STATUS}	
		)
    ]]>
       <!--  INSERT INTO
		QA (
			QA_NO,
			TITLE,
			PASSWD,
			CONTENT,
			REGDATE,
			STATUS,

			REF,
			RE_STEP,
			
			MEMBER_ID
			

		)
		VALUES (
			QA_NO_SEQ.NEXTVAL,
			#{TITLE},
			#{PASSWD},
			#{CONTENT},
			SYSDATE,
			#{STATUS}
		
			#{REF},
			#{RE_STEP},
				
			#{MEMBER_ID}
		
		 	
		) -->
     </insert>
     
     <update id="QaUpdateReplyStep" parameterType="hashmap">
    <![CDATA[
        UPDATE 
        QA 
        SET 
        
        	RE_STEP=RE_STEP+1 
        WHERE 
        
        	REF = #{REF},
        	
       
    ]]>
</update>
<select id="QA_GoodsSelectList" parameterType="hashmap" resultType="hashmap">
        <![CDATA[
          select 
 				A.GOODS_NO,
           		A.NAME,
           		A.PRICE,
                B.SAV_NAME
		  from
                GOODS A
          INNER JOIN 
                UPLOAD B 
          ON 
               A.GOODS_NO = B.GOODS_NO 
               
         ORDER BY 
               A.GOODS_NO DESC 
           		
        ]]>
    </select>
    <!-- QA 상품검색 -->
       <select id="QA_GoodsSearch" parameterType="hashmap" resultType="hashmap">
		SELECT 
				A.GOODS_NO,
           		A.NAME,
           		A.PRICE,
                B.SAV_NAME
		FROM 
			 	GOODS A
         		INNER JOIN 
                UPLOAD B 
        ON 
                A.GOODS_NO = B.GOODS_NO 	
                
		WHERE 
			<if test='SearchNum.equals("NAME")'> 	
			(NAME LIKE '%' || #{SearchKeyword} || '%')	
			</if>
			ORDER BY GOODS_NO DESC

		
</select>

 <select id="QA_GoodsSelect" parameterType="hashmap" resultType="hashmap">
      <![CDATA[
        SELECT
        	    A.GOODS_NO,
           		A.NAME,
           		A.PRICE,
                B.SAV_NAME
          FROM
                GOODS A
          INNER JOIN 
                UPLOAD B 
          ON 
               A.GOODS_NO = B.GOODS_NO 
          WHERE
               A.GOODS_NO = #{GOODS_NO}       
      ]]>
</select>

<select id="QaPasswdCheck" parameterType="hashmap" resultType="hashmap">
        <![CDATA[
           SELECT
           		QA_NO,
           		MEMBER_ID,
           		CATEGORY,
				GOODS_NO,
				STATUS
           		
           	FROM 
           		QA
           	WHERE 
           		QA_NO =#{QA_NO}
           	AND
           	PASSWD = #{PASSWD}
           		
        ]]>
    </select>
    
<select id="QaReplySel" parameterType="hashmap" resultType="hashmap">
        <![CDATA[
           SELECT 
				CATEGORY,
				GOODS_NO,
				STATUS

			FROM
  				QA	
			WHERE
				QA_NO = #{REF}		 

           		
        ]]>
    </select>

</mapper>

